# SimpleIdentityServer.API

A secure, production-ready OpenID Connect identity provider built with ASP.NET Core 8.0 and OpenIddict. This server provides OAuth 2.0 and OpenID Connect authentication and authorization services with comprehensive security monitoring and logging.

you can find the source code in the [SimpleIdentityServer](https://github.com/gnairooze/simple-identity-server) repository.

## Getting Started

### Prerequisites

this image depends on SQL server, which should have 2 databases:

- SimpleIdentityServerSecurityLogs: for logs. it must be created manually.
- SimpleIdentityServer: for identity data. the api can created it by itself if not exist.

### using docker compose

#### docker compose file

docker-compose.yml

```yaml
name: simple-identity-server

services:
  api-instance-1:
    image: gnairooze/simple-identity-server:latest
    container_name: simple-identity-server-api
    ports:
      - "8091:443"  # Direct access for testing
    env_file:
      - production.env
    environment:
      # Instance-specific configuration (only values that need to be different per instance)
      - SIMPLE_IDENTITY_SERVER_NODE_NAME=simple-identity-api-instance-1
    volumes:
      - ./certs:/app/certs
    networks:
      simple-identity-server-net:
        ipv4_address: 172.26.0.11
    restart: unless-stopped

networks:
  simple-identity-server-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.26.0.0/16
          gateway: 172.26.0.1
```

#### production.env file

it contains database connection strings, cors allowed origins, certificate password, and other environment variables.

you should changes the database connection strings according to your database server, cors allowed origins, and certificate password.

```env
# ==============================================================
# DATABASE CONFIGURATION (REQUIRED)
# ==============================================================

# Strong password for SQL Server SA account
# IMPORTANT: Change this to a secure password before deployment
SIMPLE_IDENTITY_SERVER_DB_PASSWORD=sample@Strong23Password

# Custom connection strings (RECOMMENDED - these use the same password as SIMPLE_IDENTITY_SERVER_DB_PASSWORD)
# These override the default connection strings and ensure password consistency
SIMPLE_IDENTITY_SERVER_DEFAULT_CONNECTION_STRING=Server=host.docker.internal,14333;Database=SimpleIdentityServer;MultipleActiveResultSets=true;uid=sa;pwd=sample@Strong23Password;TrustServerCertificate=true;Encrypt=true
SIMPLE_IDENTITY_SERVER_SECURITY_LOGS_CONNECTION_STRING=Server=host.docker.internal,14333;Database=SimpleIdentityServerSecurityLogs;MultipleActiveResultSets=true;uid=sa;pwd=sample@Strong23Password;TrustServerCertificate=true;Encrypt=true

# ==============================================================
# CORS CONFIGURATION
# ==============================================================

# Allowed origins for CORS (semicolon-separated)
# For development/testing:
SIMPLE_IDENTITY_SERVER_CORS_ALLOWED_ORIGINS=https://identity.dev.test;https://localhost:3000;https://localhost:5001

# For production, replace with your actual domains:
# SIMPLE_IDENTITY_SERVER_CORS_ALLOWED_ORIGINS=https://yourdomain.com;https://app.yourdomain.com;https://admin.yourdomain.com

# ==============================================================
# CERTIFICATE CONFIGURATION
# ==============================================================

# Password for certificate files
# Certificate passwords (REQUIRED for production certificates)
SIMPLE_IDENTITY_SERVER_CERT_PASSWORD=SharedCertPassword123!

# ==============================================================
# ASP.NET CORE CONFIGURATION
# ==============================================================

# Environment name
ASPNETCORE_ENVIRONMENT=Production

# URLs configuration
ASPNETCORE_URLS=https://+:443


# Kestrel Certificate Configuration
Kestrel__Certificates__Default__Path=/app/certs/identity-dev-test.crt
Kestrel__Certificates__Default__KeyPath=/app/certs/identity-dev-test.key
```

#### certificates

certificates should be placed in the `certs` folder besides the production.env file and docker-compose.yml file.

sample certificates exist in [github certs folder](https://github.com/gnairooze/simple-identity-server/tree/main/code/SimpleIdentityServer/SimpleIdentityServer.API/certs).

`encryption.pfx` and `signing.pfx` are generated by the [SimpleIdentityServer.CLI](https://github.com/gnairooze/simple-identity-server/tree/main/code/SimpleIdentityServer/SimpleIdentityServer.CLI) project and used for encryption and signing of tokens.

The CLI will automatically use the `SIMPLE_IDENTITY_SERVER_CERT_PASSWORD` environment variable for the certificate password.

**Generate encryption certificate:**

```bash
dotnet run -- cert create-encryption --path "../SimpleIdentityServer.API/certs/encryption.pfx"
```

**Generate signing certificate:**

```bash
dotnet run -- cert create-signing --path "../SimpleIdentityServer.API/certs/signing.pfx"
```

`identity-dev-test.crt` and `identity-dev-test.key` are used for the server certificate.

```bash 
# Generate certificates (replace with your domain)
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout nginx/ssl/identity-dev-test.key -out nginx/ssl/identity-dev-test.crt -subj "/C=US/ST=State/L=City/O=Organization/CN=identity.dev.test"
```

`identity-dev-test-ca.crt` and `identity-dev-test-ca.key` are used for the CA certificate.

using docker compose

```bash
docker-compose up -d
```

### using docker run

```bash
docker run -d -p 8091:443 -v ./certs:/app/certs -v ./production.env:/app/production.env -e SIMPLE_IDENTITY_SERVER_NODE_NAME=simple-identity-api-instance-1 gnairooze/simple-identity-server:latest
```

#### using docker compose

```bash
docker-compose up -d
```

## endpoints

the ssl sertificates issued to `identity.dev.test`
you can add the following line to your hosts file
127.0.0.1 identity.dev.test

base url can be `https://localhost:8091` or `https://identity.dev.test:8091`

[postman collection](https://github.com/gnairooze/simple-identity-server/blob/main/docs/SimpleIdentityServer.postman_collection.json) of sample requests

### openid configuration

GET {{baseurl}}/.well-known/openid-configuration

GET {{baseURL}}/.well-known/jwks

### get-token

{{baseURL}}/connect/token

### validate token

{{baseURL}}/connect/introspect

## how to integrate

[integration guide](https://github.com/gnairooze/simple-identity-server/blob/main/docs/identity-provider-integration-guide.md)
